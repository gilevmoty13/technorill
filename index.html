<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TechnoRill — Блог о технике</title>
  <link rel="icon" href="logo1.png" type="image/png"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <style>
    :root{
      --accent:#00cc66;
      --accent-2:#00ff80;
      --panel:rgba(0,0,0,.75);
      --line:#333;
      --bg2:rgba(30,30,30,.5);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Arial,sans-serif;color:#ccc;background:#000 url('logo.png') center/contain no-repeat fixed}
    header{background:rgba(0,0,0,.7);text-align:center;padding:40px 20px}
    header img{width:120px;height:auto;border-radius:50%}
    h1{margin:20px 0 0;font-size:2.5rem;color:var(--accent)}
    .content{max-width:980px;margin:40px auto;background:var(--panel);padding:30px;border-radius:15px}
    .tabs{display:flex;justify-content:center;margin-bottom:30px;border-bottom:1px solid var(--line)}
    .tab{padding:10px 20px;cursor:pointer;color:#888;border-bottom:3px solid transparent;transition:.25s}
    .tab.active{color:var(--accent);border-bottom-color:var(--accent)}
    .tab:hover{color:var(--accent-2)}
    .tab-content{display:none}
    .tab-content.active{display:block}
    a{color:var(--accent);text-decoration:none;border-bottom:1px dashed var(--accent)}
    a:hover{color:var(--accent-2);border-bottom-color:var(--accent-2)}
    footer{background:rgba(0,0,0,.7);text-align:center;padding:20px;color:#888}

    /* карточки */
    .news-item{
      position:relative;background:var(--bg2);padding:16px;margin:16px 0;
      border-radius:12px;border-left:3px solid var(--accent)
    }
    .news-date{color:#9bb5a7;margin-bottom:6px}
    .social-links{display:flex;flex-direction:column;gap:12px;margin-top:14px}
    .social-link{display:flex;align-items:center;padding:12px 16px;background:rgba(50,50,50,.52);border-radius:10px;border:1px solid transparent;transition:.2s}
    .social-link:hover{background:rgba(70,70,70,.7);border-color:var(--accent);transform:translateY(-1px)}
    .social-icon{font-size:22px;margin-right:14px;width:28px;text-align:center}
    .tiktok-icon{color:#fff}.youtube-icon{color:#f00}.instagram-icon{color:#E4405F}

    .news-content{margin-top:10px; line-height:1.5}
    .news-gallery{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px}
    .news-gallery img{width:100%;height:180px;object-fit:cover;border-radius:10px;border:1px solid #222}
    @media(max-width:680px){ .news-gallery{grid-template-columns:repeat(2,1fr)} .news-gallery img{height:140px} }
    @media(max-width:460px){ .news-gallery{grid-template-columns:1fr} .news-gallery img{height:auto} }

    /* центр заголовков в секциях */
    #news .post>h1, #fresh-news .post>h1 { text-align:center }

    /* плейсхолдер при пустом списке */
    .news-empty{
      text-align:center;color:#7aa68f;background:rgba(30,30,30,.35);
      border:1px dashed #2f6;padding:16px;border-radius:10px;margin-top:14px
    }

    /* кнопка удаления — в правом верхнем углу карточки */
    .news-del-btn{
      position:absolute;top:10px;right:10px;
      padding:6px 10px;border-radius:10px;border:1px solid #444;
      background:#111;color:#bbb;cursor:pointer;font-size:13px;
      display:none;
    }
    .news-del-btn:hover{border-color:var(--accent);color:var(--accent-2)}
    .admin-active .news-del-btn{display:inline-flex}

    /* уведомляшка */
    .notification{position:fixed;top:20px;right:20px;background:rgba(0,200,100,.9);color:#fff;padding:10px 20px;border-radius:6px;display:none;z-index:1000}

    /* Панель публикации (модал) */
    #publishPanel{
      position:fixed;inset:0;display:none;z-index:1199;align-items:center;justify-content:center;
      background:rgba(0,0,0,.6)
    }
    #publishCard{
      width:min(780px,96vw);max-height:92vh;overflow:auto;background:#0c0c0c;border:1px solid var(--accent);
      border-radius:14px;padding:18px;box-shadow:0 10px 40px rgba(0,0,0,.5);position:relative
    }
    #publishCard h3{color:var(--accent-2);margin-top:0}
    #publishCard label{display:block;margin:8px 0 6px}
    #publishCard input,#publishCard textarea{
      width:100%;padding:10px;border-radius:10px;border:1px solid #333;background:#000;color:#eee
    }
    #publishCard textarea{min-height:100px;resize:vertical}
    .two-col{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .two-col>div{min-width:0}
    @media(max-width:560px){ .two-col{grid-template-columns:1fr} }

    /* селектор секции */
    .seg{display:flex;gap:12px;background:#0a0a0a;border:1px solid #2a2a2a;padding:10px;border-radius:12px;align-items:center}
    .seg .seg-btn{
      flex:1;text-align:center;padding:10px 12px;border:1px solid #2a2a2a;border-radius:999px;cursor:pointer;
      user-select:none
    }
    .seg .seg-btn.active{border-color:var(--accent);box-shadow:inset 0 0 0 2px rgba(0,204,102,.25)}
    .seg small{display:block;color:#9bb5a7;margin-top:4px}

    /* сворачивание в пилюлю */
    #collapseBtn{
      position:absolute;top:10px;right:10px;border:1px solid #444;background:#111;color:#bbb;border-radius:10px;
      width:36px;height:36px;display:flex;align-items:center;justify-content:center;cursor:pointer
    }
    #publishDock{
      position:fixed;bottom:16px;right:16px;display:none;z-index:1200;
      background:#0b0b0b;border:1px solid #2f6;border-radius:999px;color:#9fe6c3;padding:10px 14px;cursor:pointer
    }

    /* Модал логина (как было) */
    #adminModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:1200;align-items:center;justify-content:center;padding:12px}
    #adminModal .modal-card{background:#111;border:1px solid var(--accent);border-radius:12px;width:min(520px,92vw);max-height:92vh;overflow:auto;padding:20px;margin:0 auto}
    #adminModal h3{color:var(--accent-2);margin:0 0 10px}
    #adminModal label{display:block;margin:10px 0 6px}
    #adminModal input{width:100%;padding:10px;border-radius:8px;border:1px solid #333;background:#000;color:#eee}
    #adminModal .btn-row{display:flex;gap:10px;margin-top:14px}
    #adminModal .btn{padding:8px 14px;border-radius:8px;cursor:pointer}
    #adminModal .btn-primary{border:1px solid var(--accent);background:#002d1f;color:var(--accent-2)}
    #adminModal .btn-ghost{border:1px solid #444;background:#222;color:#bbb}
    #adminErr{color:#ff6b6b;display:none;margin-top:10px}
  </style>
</head>
<body>
  <div class="notification" id="notification">Почта скопирована!</div>

  <header>
    <img src="logo1.png" alt="TechnoRill Logo"/>
    <h1>TechnoRill</h1>
    <p>Блог о технологиях</p>
  </header>

  <div class="content">
    <div class="tabs">
      <div class="tab" data-tab="main">Главная</div>
      <div class="tab" data-tab="fresh-news">Свежие новости о технологиях</div>
      <div class="tab active" data-tab="news">Последние публикации</div>
      <div class="tab" data-tab="contacts">Контакты</div>
    </div>

    <div id="main" class="tab-content">
      <div class="post">
        <h1 style="text-align:center">Добро пожаловать!</h1>
        <p style="text-align:center">Канал TechnoRill рассказывает о технике и гаджетах!</p>
      </div>
    </div>

    <div id="fresh-news" class="tab-content">
      <div class="post">
        <h1>Свежие новости о технологиях</h1>
        <!-- FRESH-START -->
        <!-- FRESH-END -->
      </div>
    </div>

    <div id="news" class="tab-content active">
      <div class="post">
        <h1>Видео за месяц</h1>
        <!-- NEWS-START -->
        <!-- NEWS-END -->
      </div>
    </div>

    <div id="contacts" class="tab-content">
      <div class="post" style="text-align:center">
        <h2>Контакты</h2>
        <p>Привет! Меня зовут Кирилл и я ведущий данного канала.</p>
        <p><strong>Почта:</strong>
          <span id="email" style="color:var(--accent);cursor:pointer;border-bottom:1px dashed var(--accent)">garkovivan8430@gmail.com</span>
          <span style="margin-left:5px;font-size:.9em;color:#888">(кликните чтобы скопировать)</span>
        </p>
        <p><strong>По вопросам писать:</strong>
          <a href="https://t.me/kiril_podderzka_Not_Bot" target="_blank" class="telegram-link">t.me/kiril_podderzka_Not_Bot</a>
        </p>
      </div>
    </div>
  </div>

  <footer>
    © 2025 Кирилл.
    <p style="margin-top:10px;font-size:.8em;">*компания Meta признана экстремистской на территории России</p>
  </footer>

  <!-- Модал логина -->
  <div id="adminModal">
    <div class="modal-card">
      <h3>Вход для администратора</h3>
      <label>Логин</label>
      <input id="adminLogin" type="text" placeholder="Логин"/>
      <label>Пароль</label>
      <input id="adminPass" type="password" placeholder="Пароль"/>
      <div class="btn-row">
        <button id="adminLoginBtn" class="btn btn-primary">Войти</button>
        <button id="adminCancelBtn" class="btn btn-ghost">Отмена</button>
      </div>
      <p id="adminErr">Неверные данные</p>
    </div>
  </div>

  <!-- ПАНЕЛЬ ПУБЛИКАЦИИ (модал + док) -->
  <div id="publishPanel">
    <div id="publishCard">
      <button id="collapseBtn" title="Свернуть"><i class="fa-solid fa-chevron-down"></i></button>
      <h3>Публикация новости</h3>

      <label>Куда публиковать</label>
      <div class="seg" id="sectionSeg">
        <div class="seg-btn active" data-section="news">
          Последние публикации
          <small>Попадёт в раздел «Видео за месяц»</small>
        </div>
        <div class="seg-btn" data-section="fresh">
          Свежие новости о технологиях
          <small>Новая карточка в этой вкладке</small>
        </div>
      </div>

      <label>Дата (текст):</label>
      <input id="fDate" type="text" placeholder="27 сентября 2025"/>

      <label>Заголовок:</label>
      <input id="fTitle" type="text" placeholder="Вышло новое видео!"/>

      <label>Короткое описание (необязательно):</label>
      <input id="fDesc" type="text" placeholder="Короткое описание"/>

      <label>Контент (текст):</label>
      <textarea id="fContent" placeholder="Основной текст новости. Поддерживает переносы строк."></textarea>

      <label>Изображения (по одному URL на строку):</label>
      <textarea id="fImages" placeholder="https://...jpg
https://...png"></textarea>

      <div class="two-col" style="margin-top:8px">
        <div>
          <label>TikTok ссылка:</label>
          <input id="fTikTok" type="url" placeholder="https://www.tiktok.com/..."/>
        </div>
        <div>
          <label>YouTube ссылка:</label>
          <input id="fYouTube" type="url" placeholder="https://youtube.com/..."/>
        </div>
        <div>
          <label>Instagram ссылка:</label>
          <input id="fInsta" type="url" placeholder="https://www.instagram.com/reel/..."/>
        </div>
      </div>

      <button id="publishBtn" style="margin-top:14px;padding:12px 14px;border-radius:10px;border:1px solid var(--accent);background:#002d1f;color:var(--accent-2);cursor:pointer;width:100%">Опубликовать</button>

      <div id="exportWrap" style="display:none;margin-top:12px">
        <p style="margin:6px 0 4px;color:#9fe6c3">Код вставки (на случай ручного сохранения):</p>
        <textarea id="exportHtml" rows="8"></textarea>
      </div>
    </div>
  </div>
  <div id="publishDock" title="Открыть публикацию"><i class="fa-solid fa-pen-to-square" style="margin-right:6px"></i>Публикация</div>

  <script>
    // вкладки + копирование почты
    document.addEventListener('DOMContentLoaded', () => {
      const email = document.getElementById('email');
      const note = document.getElementById('notification');
      if (email){
        email.addEventListener('click', () => {
          navigator.clipboard.writeText('garkovivan8430@gmail.com').then(()=>{
            note.style.display='block'; setTimeout(()=>note.style.display='none',1800);
          });
        });
      }
      document.querySelectorAll('.tab').forEach(t=>{
        t.addEventListener('click', ()=>{
          const id = t.getAttribute('data-tab');
          document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(x=>x.classList.remove('active'));
          t.classList.add('active');
          document.getElementById(id).classList.add('active');
        });
      });
    });
  </script>

  <!-- Админ-логика + публикация -->
  <script>
  (function(){
    const WORKER_BASE = 'https://falling-term-2b37.garkovkirill.workers.dev';
    const ADMIN_HEADER = '30Mu30Fasa';

    const SALT='trill#2025';
    const HASH_LOGIN='01001e8a19aa584d87efe4ebbd09ec191267921d39e1f845a4ac932916de1323';
    const HASH_PASS ='7491d3a47818924589874ef588685df9e0f2e2fd21122f34a4a427b7d9360d46';

    async function sha256Hex(s){
      const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(SALT+s));
      return [...new Uint8Array(buf)].map(b=>b.toString(16).padStart(2,'0')).join('');
    }

    const adminModal=document.getElementById('adminModal');
    const adminLoginBtn=document.getElementById('adminLoginBtn');
    const adminCancelBtn=document.getElementById('adminCancelBtn');
    const adminErr=document.getElementById('adminErr');
    const loginInput=document.getElementById('adminLogin');
    const passInput=document.getElementById('adminPass');

    const publishPanel=document.getElementById('publishPanel');
    const publishCard=document.getElementById('publishCard');
    const dock=document.getElementById('publishDock');
    const collapseBtn=document.getElementById('collapseBtn');

    const fDate=document.getElementById('fDate');
    const fTitle=document.getElementById('fTitle');
    const fDesc=document.getElementById('fDesc');
    const fContent=document.getElementById('fContent');
    const fImages=document.getElementById('fImages');
    const fTikTok=document.getElementById('fTikTok');
    const fYouTube=document.getElementById('fYouTube');
    const fInsta=document.getElementById('fInsta');

    const publishBtn=document.getElementById('publishBtn');
    const exportWrap=document.getElementById('exportWrap');
    const exportHtml=document.getElementById('exportHtml');

    // выбор секции
    let currentSection = 'news';
    document.getElementById('sectionSeg').addEventListener('click', (e)=>{
      const btn = e.target.closest('.seg-btn'); if(!btn) return;
      document.querySelectorAll('.seg-btn').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      currentSection = btn.getAttribute('data-section') || 'news';
    });

    // сворачивание/разворачивание
    collapseBtn.addEventListener('click', ()=>{
      publishPanel.style.display='none';
      dock.style.display='flex';
    });
    dock.addEventListener('click', ()=>{
      dock.style.display='none';
      publishPanel.style.display='flex';
    });

    // открыть логин
    function openLogin(){
      if(adminModal.style.display==='flex')return;
      adminErr.style.display='none'; loginInput.value=''; passInput.value='';
      adminModal.style.display='flex'; setTimeout(()=>loginInput.focus(),0);
    }

    // хоткеи
    document.addEventListener('keydown',(e)=>{
      const isCtrl=(e.ctrlKey||e.metaKey), k=e.key.toLowerCase();
      if(isCtrl && k==='a'){ e.preventDefault(); openLogin(); }
      if(isCtrl && e.shiftKey && k==='a'){ e.preventDefault(); openLogin(); }
      if(k==='escape'){
        if(adminModal.style.display==='flex') adminModal.style.display='none';
        else if(publishPanel.style.display==='flex'){ publishPanel.style.display='none'; dock.style.display='flex'; }
      }
    });
    adminCancelBtn.addEventListener('click',()=> adminModal.style.display='none');
    adminModal.addEventListener('click',e=>{ if(e.target===adminModal) adminModal.style.display='none'; });

    async function tryLogin(){
      try{
        const okLogin=(await sha256Hex(loginInput.value.trim()))===HASH_LOGIN;
        const okPass=(await sha256Hex(passInput.value))===HASH_PASS;
        if(okLogin && okPass){
          document.body.classList.add('admin-active');
          adminModal.style.display='none';
          publishPanel.style.display='flex'; dock.style.display='none';
          publishPanel.scrollTop=0;
          adminErr.style.display='none';
          if(!fDate.value) fDate.value = new Date().toLocaleDateString('ru-RU',{day:'2-digit',month:'long',year:'numeric'});
        }else adminErr.style.display='block';
      }catch(e){ console.error(e); adminErr.style.display='block';}
    }
    adminLoginBtn.addEventListener('click',tryLogin);
    passInput.addEventListener('keydown',e=>{ if(e.key==='Enter') tryLogin(); });

    // хелперы
    function uid(){ return Date.now().toString(36)+Math.random().toString(36).slice(2,6) }
    function esc(s){ return (s??'').toString().replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    function ensurePlaceholder(section){
      const post = section==='fresh' ? document.querySelector('#fresh-news .post') : document.querySelector('#news .post');
      const has = post.querySelector('.news-item');
      let ph = post.querySelector('.news-empty');
      if(!has && !ph){
        ph = document.createElement('div'); ph.className='news-empty';
        ph.textContent='Пока здесь пусто. Опубликуй первую новость через админ-панель.';
        const h1 = post.querySelector('h1');
        post.insertBefore(ph, h1? h1.nextSibling : post.firstChild);
      }
      if(has && ph) ph.remove();
    }

    function buildCardHTML(data){
      const imgs = (data.images||[]).filter(Boolean);
      const gallery = imgs.length ? `<div class="news-gallery">${imgs.map(u=>`<img src="${esc(u)}" alt="">`).join('')}</div>` : '';
      const contentHtml = data.content
        ? `<div class="news-content">${esc(data.content).replace(/\n/g,'<br>')}</div>`
        : '';
      const link=(href,icon,txt,cls)=> href?`<a href="${href}" target="_blank" class="social-link"><i class="${icon} social-icon ${cls||''}"></i><div><div class="social-text">${txt}</div></div></a>`:'';
      return `
<div class="news-item" data-id="${esc(data.id)}" data-section="${esc(data.section)}">
  <button class="news-del-btn" title="Удалить">Удалить</button>
  <div class="news-date">${esc(data.date)}</div>
  <h3>${esc(data.title)}</h3>
  ${data.desc?`<p>${esc(data.desc)}</p>`:''}
  ${contentHtml}
  ${gallery}
  <div class="social-links">
    ${link(data.tiktok,'fab fa-tiktok','TikTok','tiktok-icon')}
    ${link(data.youtube,'fab fa-youtube','YouTube','youtube-icon')}
    ${link(data.insta,'fab fa-instagram','Instagram*','instagram-icon')}
  </div>
</div>`.trim();
    }

    function insertCardDom(section, html){
      const post = section==='fresh' ? document.querySelector('#fresh-news .post') : document.querySelector('#news .post');
      const container = document.createElement('div'); container.innerHTML = html;
      const card = container.firstElementChild;
      const firstItem = post.querySelector('.news-item');
      if(firstItem) post.insertBefore(card, firstItem);
      else post.appendChild(card);
      return card;
    }

    function parseImages(text){
      return (text||'')
        .split(/\r?\n/)
        .map(s=>s.trim())
        .filter(s=>s.length>0);
    }

    publishBtn.addEventListener('click', ()=>{
      const data = {
        id: uid(),
        section: currentSection,
        date: fDate.value.trim() || new Date().toLocaleDateString('ru-RU',{day:'2-digit',month:'long',year:'numeric'}),
        title: fTitle.value.trim(),
        desc: fDesc.value.trim(),
        content: fContent.value.trim(),
        images: parseImages(fImages.value),
        tiktok: fTikTok.value.trim(),
        youtube: fYouTube.value.trim(),
        insta: fInsta.value.trim()
      };
      if(!data.title){ alert('Укажи заголовок.'); return; }
      if(!data.tiktok && !data.youtube && !data.insta && !data.content && (!data.images || !data.images.length)){
        if(!confirm('Вы не добавили ни ссылок, ни текст/картинки. Продолжить?')) return;
      }

      const html = buildCardHTML(data);
      insertCardDom(data.section, html);
      ensurePlaceholder(data.section);

      exportWrap.style.display='block';
      exportHtml.value = html;

      // Отправка воркеру
      if(/^https?:\/\//.test(WORKER_BASE)){
        fetch(WORKER_BASE+'/publish',{
          method:'POST',
          headers:{'Content-Type':'application/json','x-admin-key':ADMIN_HEADER},
          body: JSON.stringify(data) // воркер может использовать section, content, images при доработке
        })
        .then(async r=>{
          const text=await r.text(); let json; try{json=JSON.parse(text)}catch{}
          if(!r.ok||!json?.ok){
            console.error('Worker publish error',r.status,text);
            alert('Ошибка публикации ('+r.status+'): '+text+'\nЗапись добавлена локально.');
          } else {
            alert('Опубликовано и сохранено в GitHub.');
          }
        })
        .catch(err=>{
          console.error(err);
          alert('Сетевая ошибка: '+(err?.message || err));
        });
      }
    });

    // делегирование удаления
    document.addEventListener('click', (e)=>{
      const btn = e.target.closest('.news-del-btn'); if(!btn) return;
      const card = btn.closest('.news-item');
      const id = card?.getAttribute('data-id')||'';
      const section = card?.getAttribute('data-section')||'news';
      if(!confirm('Удалить публикацию?')) return;

      card.remove();
      ensurePlaceholder(section);

      if(/^https?:\/\//.test(WORKER_BASE)){
        fetch(WORKER_BASE+'/delete',{
          method:'POST',
          headers:{'Content-Type':'application/json','x-admin-key':ADMIN_HEADER},
          body: JSON.stringify({ id, section })
        }).then(async r=>{
          const t=await r.text(); let j; try{j=JSON.parse(t)}catch{}
          if(!r.ok||!j?.ok){
            console.error('Worker delete error',r.status,t);
            alert('Удаление на сервере не удалось ('+r.status+'). Карточка скрыта локально.');
          }
        }).catch(err=>{
          console.error(err); alert('Сетевая ошибка при удалении: '+(err?.message||err));
        });
      }
    });

    // клик по копирайту — вход админа
    document.querySelector('footer').addEventListener('click', openLogin);

    // старт: плейсхолдеры
    ['news','fresh'].forEach(ensurePlaceholder);
  })();
  </script>
</body>
</html>
