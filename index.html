<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TechnoRill — Блог о технике</title>
  <link rel="icon" href="logo1.png" type="image/png"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <style>
    :root{ --accent:#00cc66; --accent-2:#00ff80; --panel:rgba(0,0,0,.75); --line:#333; }
    *{box-sizing:border-box}
    body{margin:0;font-family:Arial,sans-serif;color:#ccc;background:#000 url('logo.png') center/contain no-repeat fixed}
    header{background:rgba(0,0,0,.7);text-align:center;padding:40px 20px}
    header img{width:120px;height:auto;border-radius:50%}
    h1{margin:20px 0 0;font-size:2.5rem;color:var(--accent)}
    .content{max-width:980px;margin:40px auto;background:var(--panel);padding:30px;border-radius:15px}
    .tabs{display:flex;justify-content:center;margin-bottom:30px;border-bottom:1px solid var(--line)}
    .tab{padding:10px 20px;cursor:pointer;color:#888;border-bottom:3px solid transparent;transition:.25s}
    .tab.active{color:var(--accent);border-bottom-color:var(--accent)}
    .tab:hover{color:var(--accent-2)}
    .tab-content{display:none}
    .tab-content.active{display:block}
    a{color:var(--accent);text-decoration:none;border-bottom:1px dashed var(--accent)}
    a:hover{color:var(--accent-2);border-bottom-color:var(--accent-2)}
    footer{background:rgba(0,0,0,.7);text-align:center;padding:20px;color:#888}

    /* карточки */
    .news-item{
      position:relative;background:rgba(30,30,30,.5);
      padding:16px;margin:16px 0;border-radius:12px;border-left:3px solid var(--accent)
    }
    .news-date{color:#9bb5a7;margin-bottom:6px}
    .social-links{display:flex;flex-direction:column;gap:12px;margin-top:14px}
    .social-link{display:flex;align-items:center;padding:12px 16px;background:rgba(50,50,50,.52);border-radius:10px;border:1px solid transparent;transition:.2s}
    .social-link:hover{background:rgba(70,70,70,.7);border-color:var(--accent);transform:translateY(-1px)}
    .social-icon{font-size:22px;margin-right:14px;width:28px;text-align:center}
    .tiktok-icon{color:#fff}.youtube-icon{color:#f00}.instagram-icon{color:#E4405F}

    /* выравнивание заголовков секций по центру */
    #news .post>h1, #fresh-news .post>h1 { text-align:center }

    /* плейсхолдер при пустом списке */
    .news-empty{
      text-align:center;color:#7aa68f;background:rgba(30,30,30,.35);
      border:1px dashed #2f6;padding:16px;border-radius:10px;margin-top:14px
    }

    /* кнопка удаления — в правом верхнем углу карточки */
    .news-del-btn{
      position:absolute;top:10px;right:10px;padding:6px 10px;border-radius:10px;border:1px solid #444;
      background:#111;color:#bbb;cursor:pointer;font-size:13px;display:none;
    }
    .news-del-btn:hover{border-color:var(--accent);color:var(--accent-2)}
    .admin-active .news-del-btn{display:inline-flex}

    /* уведомляшка */
    .notification{position:fixed;top:20px;right:20px;background:rgba(0,200,100,.9);color:#fff;padding:10px 20px;border-radius:6px;display:none;z-index:1000}

    /* ПАНЕЛЬ ПУБЛИКАЦИИ */
    #publishPanel{
      box-sizing:border-box;width:min(560px,96vw);
      right:12px;bottom:12px;max-height:90vh;overflow:auto;
      position:fixed;background:rgba(0,0,0,.96);border:1px solid var(--accent);
      border-radius:16px;padding:16px;z-index:1199;display:none
    }
    #publishPanel label{display:block;margin:8px 0 6px}
    #publishPanel input,#publishPanel textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #333;background:#000;color:#eee}
    #publishPanel textarea{min-height:160px;resize:vertical}
    #publishPanel .two-col{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    #publishPanel .two-col>div{min-width:0}
    #publishPanel .panel-head{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:8px}
    #publishPanel .head-title{color:var(--accent-2);font-weight:700}
    #collapsePublish{
      border:1px solid #444;background:#111;color:#bbb;border-radius:10px;padding:6px 10px;cursor:pointer
    }
    @media (max-width:560px){
      #publishPanel{left:8px;right:8px;top:8px;bottom:8px;max-height:calc(100vh - 16px)}
      #publishPanel .two-col{grid-template-columns:1fr}
    }

    /* Мини-кнопка для свёрнутой панели */
    #publishMin{
      position:fixed;right:12px;bottom:12px;width:46px;height:46px;border-radius:50%;
      background:#111;border:1px solid var(--accent);color:#9fe6c3;display:none;
      align-items:center;justify-content:center;z-index:1198;cursor:pointer;font-size:18px
    }
    .admin-active #publishMin{display:flex}

    /* Модал логина */
    #adminModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:1200;align-items:center;justify-content:center;padding:12px}
    #adminModal .modal-card{background:#111;border:1px solid var(--accent);border-radius:12px;width:min(520px,92vw);max-height:92vh;overflow:auto;padding:20px;margin:0 auto}
    #adminModal h3{color:var(--accent-2);margin:0 0 10px}
    #adminModal label{display:block;margin:10px 0 6px}
    #adminModal input{width:100%;padding:10px;border-radius:8px;border:1px solid #333;background:#000;color:#eee}
    #adminModal .btn-row{display:flex;gap:10px;margin-top:14px}
    #adminModal .btn{padding:8px 14px;border-radius:8px;cursor:pointer}
    #adminModal .btn-primary{border:1px solid var(--accent);background:#002d1f;color:var(--accent-2)}
    #adminModal .btn-ghost{border:1px solid #444;background:#222;color:#bbb}
    #adminErr{color:#ff6b6b;display:none;margin-top:10px}

    /* скрытый триггер во футере */
    .admin-trigger{cursor:pointer;user-select:none}
    .admin-trigger:active{opacity:.85}
  </style>
</head>
<body>
  <div class="notification" id="notification">Почта скопирована!</div>

  <header>
    <img src="logo1.png" alt="TechnoRill Logo"/>
    <h1>TechnoRill</h1>
    <p>Блог о технологиях</p>
  </header>

  <div class="content">
    <div class="tabs">
      <div class="tab" data-tab="main">Главная</div>
      <div class="tab" data-tab="fresh-news">Свежие новости о технологиях</div>
      <div class="tab active" data-tab="news">Последние публикации</div>
      <div class="tab" data-tab="contacts">Контакты</div>
    </div>

    <div id="main" class="tab-content">
      <div class="post">
        <h1 style="text-align:center">Добро пожаловать!</h1>
        <p style="text-align:center">Канал TechnoRill рассказывает о технике и гаджетах!</p>
      </div>
    </div>

    <div id="fresh-news" class="tab-content">
      <div class="post">
        <h1>Свежие новости о технологиях</h1>
        <!-- FRESH-START -->
        <!-- примеры можно удалить -->
        <div class="news-empty">Пока здесь пусто.</div>
        <!-- FRESH-END -->
      </div>
    </div>

    <div id="news" class="tab-content active">
      <div class="post">
        <h1>Видео за месяц</h1>
        <!-- NEWS-START -->
        <div class="news-item" data-id="demo">
          <button class="news-del-btn" title="Удалить">Удалить</button>
          <div class="news-date">27 сентября 2025</div>
          <h3>Очищать память на iPhone стало легче?</h3>
          <p>В этом видео ты узнаешь об очень полезном приложении для iPhone!</p>
          <div class="social-links">
            <a href="https://www.tiktok.com/@technorill/video/7553701581309480214" target="_blank" class="social-link">
              <i class="fab fa-tiktok social-icon tiktok-icon"></i><div><div class="social-text">TikTok</div></div>
            </a>
            <a href="https://youtube.com/shorts/Yrtjg5RFcFE" target="_blank" class="social-link">
              <i class="fab fa-youtube social-icon youtube-icon"></i><div><div class="social-text">YouTube</div></div>
            </a>
            <a href="https://www.instagram.com/reel/DO_prhlDivv" target="_blank" class="social-link">
              <i class="fab fa-instagram social-icon instagram-icon"></i><div><div class="social-text">Instagram*</div></div>
            </a>
          </div>
        </div>
        <!-- NEWS-END -->
      </div>
    </div>

    <div id="contacts" class="tab-content">
      <div class="post" style="text-align:center">
        <h2>Контакты</h2>
        <p>Привет! Меня зовут Кирилл и я ведущий данного канала.</p>
        <p><strong>Почта:</strong>
          <span id="email" style="color:var(--accent);cursor:pointer;border-bottom:1px dashed var(--accent)">garkovivan8430@gmail.com</span>
          <span style="margin-left:5px;font-size:.9em;color:#888">(кликните чтобы скопировать)</span>
        </p>
        <p><strong>По вопросам писать:</strong>
          <a href="https://t.me/kiril_podderzka_Not_Bot" target="_blank" class="telegram-link">t.me/kiril_podderzka_Not_Bot</a>
        </p>
      </div>
    </div>
  </div>

  <footer>
    <span id="adminTrigger" class="admin-trigger">© 2025 Кирилл.</span>
    <p style="margin-top:10px;font-size:.8em">*компания Meta признана экстремистской на территории России</p>
  </footer>

  <!-- Модал логина -->
  <div id="adminModal">
    <div class="modal-card">
      <h3>Вход для администратора</h3>
      <label>Логин</label>
      <input id="adminLogin" type="text" placeholder="Логин"/>
      <label>Пароль</label>
      <input id="adminPass" type="password" placeholder="Пароль"/>
      <div class="btn-row">
        <button id="adminLoginBtn" class="btn btn-primary">Войти</button>
        <button id="adminCancelBtn" class="btn btn-ghost">Отмена</button>
      </div>
      <p id="adminErr">Неверные данные</p>
    </div>
  </div>

  <!-- ПАНЕЛЬ ПУБЛИКАЦИИ -->
  <div id="publishPanel">
    <div class="panel-head">
      <strong class="head-title">Публикация новости</strong>
      <!-- стрелка-сворачивание -->
      <button id="collapsePublish" title="Свернуть в кнопку">▾</button>
    </div>

    <!-- выбор секции -->
    <fieldset style="border:1px solid #244;border-radius:10px;padding:10px;margin-bottom:10px">
      <legend style="padding:0 6px;color:#9fe6c3">Куда публиковать</legend>
      <label style="display:inline-flex;align-items:center;gap:6px;margin-right:14px">
        <input type="radio" name="dest" id="destNews" value="news" checked/>
        Последние публикации
      </label>
      <label style="display:inline-flex;align-items:center;gap:6px">
        <input type="radio" name="dest" id="destFresh" value="fresh"/>
        Свежие новости о технологиях
      </label>
    </fieldset>

    <label>Дата (текст):</label>
    <input id="fDate" type="text" placeholder="27 сентября 2025"/>

    <label>Заголовок:</label>
    <input id="fTitle" type="text" placeholder="Вышло новое видео!"/>

    <label>Описание (необязательно):</label>
    <input id="fDesc" type="text" placeholder="Короткое описание"/>

    <div class="two-col">
      <div>
        <label>TikTok ссылка:</label>
        <input id="fTikTok" type="url" placeholder="https://www.tiktok.com/..."/>
      </div>
      <div>
        <label>YouTube ссылка:</label>
        <input id="fYouTube" type="url" placeholder="https://youtube.com/..."/>
      </div>
      <div>
        <label>Instagram ссылка:</label>
        <input id="fInsta" type="url" placeholder="https://www.instagram.com/reel/..."/>
      </div>
    </div>

    <button id="publishBtn" style="margin-top:12px;padding:10px 14px;border-radius:8px;border:1px solid var(--accent);background:#002d1f;color:var(--accent-2);cursor:pointer;width:100%">Опубликовать</button>

    <div id="exportWrap" style="display:none;margin-top:12px">
      <p style="margin:6px 0 4px;color:#9fe6c3">Скопируй этот HTML и вставь в код (если автосохранение отключено):</p>
      <textarea id="exportHtml" rows="8"></textarea>
      <button id="copyExport" style="margin-top:8px;padding:8px 12px;border-radius:8px;border:1px solid var(--accent);background:#002d1f;color:var(--accent-2);cursor:pointer">Скопировать</button>
    </div>
  </div>

  <!-- мини-кнопка для свёрнутой панели -->
  <button id="publishMin" title="Открыть публикацию">▲</button>

  <script>
    // базовые вкладки + копирование почты
    document.addEventListener('DOMContentLoaded', () => {
      const email = document.getElementById('email');
      const note = document.getElementById('notification');
      if (email){
        email.addEventListener('click', () => {
          navigator.clipboard.writeText('garkovivan8430@gmail.com').then(()=>{
            note.style.display='block'; setTimeout(()=>note.style.display='none',1800);
          });
        });
      }
      document.querySelectorAll('.tab').forEach(t=>{
        t.addEventListener('click', ()=>{
          const id = t.getAttribute('data-tab');
          document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(x=>x.classList.remove('active'));
          t.classList.add('active');
          document.getElementById(id).classList.add('active');
        });
      });
    });
  </script>

  <!-- Админ-логика -->
  <script>
  (function(){
    const WORKER_BASE = 'https://falling-term-2b37.garkovkirill.workers.dev';
    const ADMIN_HEADER = '30Mu30Fasa';

    const SALT='trill#2025';
    const HASH_LOGIN='01001e8a19aa584d87efe4ebbd09ec191267921d39e1f845a4ac932916de1323';
    const HASH_PASS ='7491d3a47818924589874ef588685df9e0f2e2fd21122f34a4a427b7d9360d46';

    async function sha256Hex(s){
      const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(SALT+s));
      return [...new Uint8Array(buf)].map(b=>b.toString(16).padStart(2,'0')).join('');
    }

    const adminModal=document.getElementById('adminModal');
    const adminLoginBtn=document.getElementById('adminLoginBtn');
    const adminCancelBtn=document.getElementById('adminCancelBtn');
    const adminErr=document.getElementById('adminErr');
    const loginInput=document.getElementById('adminLogin');
    const passInput=document.getElementById('adminPass');

    const PUBLISH_PANEL=document.getElementById('publishPanel');
    const publishMin=document.getElementById('publishMin');
    const collapsePublish=document.getElementById('collapsePublish');

    const fDate=document.getElementById('fDate');
    const fTitle=document.getElementById('fTitle');
    const fDesc=document.getElementById('fDesc');
    const fTikTok=document.getElementById('fTikTok');
    const fYouTube=document.getElementById('fYouTube');
    const fInsta=document.getElementById('fInsta');

    const publishBtn=document.getElementById('publishBtn');
    const exportWrap=document.getElementById('exportWrap');
    const exportHtml=document.getElementById('exportHtml');
    const copyExport=document.getElementById('copyExport');

    const newsPost=document.querySelector('#news .post');
    const freshPost=document.querySelector('#fresh-news .post');

    function openLogin(){ if(adminModal.style.display==='flex')return;
      adminErr.style.display='none'; loginInput.value=''; passInput.value='';
      adminModal.style.display='flex'; setTimeout(()=>loginInput.focus(),0);
    }

    // Горячие клавиши
    document.addEventListener('keydown',(e)=>{
      const isCtrl=(e.ctrlKey||e.metaKey), k=e.key.toLowerCase();
      if(isCtrl && k==='a'){ e.preventDefault(); openLogin(); }
      if(isCtrl && e.shiftKey && k==='a'){ e.preventDefault(); openLogin(); }
      if(k==='escape'){
        if(adminModal.style.display==='flex') adminModal.style.display='none';
        if(PUBLISH_PANEL.style.display==='block'){ PUBLISH_PANEL.style.display='none'; publishMin.style.display='flex'; }
      }
    });
    adminCancelBtn.addEventListener('click',()=> adminModal.style.display='none');
    adminModal.addEventListener('click',e=>{ if(e.target===adminModal) adminModal.style.display='none'; });

    // скрытый вход по футеру: тройной клик или длинное нажатие
    (function(){
      const trigger = document.getElementById('adminTrigger');
      if(!trigger) return;
      let clicks=0, timer=null;
      trigger.addEventListener('click',()=>{ clicks++; clearTimeout(timer); timer=setTimeout(()=>clicks=0,800); if(clicks>=3){clicks=0; openLogin();} });
      let pressTimer=null;
      const start=(e)=>{ e.preventDefault(); pressTimer=setTimeout(()=>openLogin(),700); };
      const cancel=()=> clearTimeout(pressTimer);
      trigger.addEventListener('mousedown',start); trigger.addEventListener('touchstart',start,{passive:false});
      trigger.addEventListener('mouseup',cancel); trigger.addEventListener('mouseleave',cancel);
      trigger.addEventListener('touchend',cancel); trigger.addEventListener('touchcancel',cancel);
    })();

    async function tryLogin(){
      try{
        const okLogin=(await sha256Hex(loginInput.value.trim()))===HASH_LOGIN;
        const okPass =(await sha256Hex(passInput.value))===HASH_PASS;
        if(okLogin&&okPass){
          document.body.classList.add('admin-active');
          adminModal.style.display='none';
          PUBLISH_PANEL.style.display='block';
          publishMin.style.display='none';
          PUBLISH_PANEL.scrollTop=0;
          adminErr.style.display='none';
        }else adminErr.style.display='block';
      }catch(e){ console.error(e); adminErr.style.display='block';}
    }
    adminLoginBtn.addEventListener('click',tryLogin);
    passInput.addEventListener('keydown',e=>{ if(e.key==='Enter') tryLogin(); });

    // сворачивание/разворачивание панели
    collapsePublish.addEventListener('click',()=>{
      PUBLISH_PANEL.style.display='none';
      publishMin.style.display='flex';
    });
    publishMin.addEventListener('click',()=>{
      publishMin.style.display='none';
      PUBLISH_PANEL.style.display='block';
      PUBLISH_PANEL.scrollTop=0;
    });

    function uid(){ return Date.now().toString(36)+Math.random().toString(36).slice(2,6) }

    function ensureEmptyPlaceholder(container){
      const has = container.querySelector('.news-item');
      let ph = container.querySelector('.news-empty');
      if(!has && !ph){
        ph = document.createElement('div'); ph.className='news-empty';
        ph.textContent='Пока здесь пусто. Опубликуй первую новость через админ-панель.';
        const h1 = container.querySelector('h1');
        container.insertBefore(ph, h1? h1.nextSibling: container.firstChild);
      }
      if(has && ph) ph.remove();
    }

    function buildNewsHTML(data){
      const esc = s => (s??'').toString().replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
      const link = (href,icon,txt,cls)=> href?`<a href="${href}" target="_blank" class="social-link"><i class="${icon} social-icon ${cls||''}"></i><div><div class="social-text">${txt}</div></div></a>`:'';
      return `
<div class="news-item" data-id="${esc(data.id)}">
  <button class="news-del-btn" title="Удалить">Удалить</button>
  <div class="news-date">${esc(data.date)}</div>
  <h3>${esc(data.title)}</h3>
  ${data.desc?`<p>${esc(data.desc)}</p>`:''}
  <div class="social-links">
    ${link(data.tiktok,'fab fa-tiktok','TikTok','tiktok-icon')}
    ${link(data.youtube,'fab fa-youtube','YouTube','youtube-icon')}
    ${link(data.insta,'fab fa-instagram','Instagram*','instagram-icon')}
  </div>
</div>`.trim();
    }

    function insertNewsCardDom(html, container){
      const firstItem = container.querySelector('.news-item');
      const card = document.createElement('div');
      card.innerHTML = html;
      const el = card.firstElementChild;
      if(firstItem) container.insertBefore(el, firstItem);
      else container.appendChild(el);
      return el;
    }

    // публикация
    publishBtn.addEventListener('click', ()=>{
      const dest = document.getElementById('destFresh').checked ? 'fresh' : 'news';
      const container = (dest==='fresh') ? freshPost : newsPost;

      const data = {
        id: uid(),
        section: dest,                 // <- для воркера
        date: fDate.value.trim() || new Date().toLocaleDateString('ru-RU',{day:'2-digit',month:'long',year:'numeric'}),
        title: fTitle.value.trim(),
        desc: fDesc.value.trim(),
        tiktok: fTikTok.value.trim(),
        youtube: fYouTube.value.trim(),
        insta: fInsta.value.trim()
      };
      if(!data.title){ alert('Укажи заголовок.'); return; }
      if(!data.tiktok && !data.youtube && !data.insta){ alert('Добавь хотя бы одну ссылку.'); return; }

      const html = buildNewsHTML(data);
      insertNewsCardDom(html, container);
      ensureEmptyPlaceholder(container);

      exportWrap.style.display='block';
      exportHtml.value = html;

      if(/^https?:\/\//.test(WORKER_BASE)){
        fetch(WORKER_BASE + '/publish', {
          method:'POST',
          headers:{'Content-Type':'application/json','x-admin-key':ADMIN_HEADER},
          body: JSON.stringify(data)
        }).then(async r=>{
          const text = await r.text(); let json; try{ json=JSON.parse(text);}catch{}
          if(!r.ok || !json?.ok){
            console.error('Worker publish error', r.status, text);
            alert('Ошибка публикации ('+r.status+'): '+text);
          }else{
            alert('Опубликовано и сохранено в GitHub.');
          }
        }).catch(err=>{
          console.error(err); alert('Сетевая ошибка: '+(err?.message||err));
        });
      }
    });

    // делегирование удаления — на обе секции
    function bindDelete(container){
      container.addEventListener('click', (e)=>{
        const btn = e.target.closest('.news-del-btn');
        if(!btn) return;
        const card = btn.closest('.news-item');
        const id = card?.getAttribute('data-id')||'';
        if(!confirm('Удалить публикацию?')) return;

        card.remove();
        ensureEmptyPlaceholder(container);

        if(/^https?:\/\//.test(WORKER_BASE)){
          fetch(WORKER_BASE+'/delete',{method:'POST',
            headers:{'Content-Type':'application/json','x-admin-key':ADMIN_HEADER},
            body: JSON.stringify({ id, section: (container===freshPost?'fresh':'news') })})
          .then(async r=>{ const t=await r.text(); let j; try{j=JSON.parse(t)}catch{}
            if(!r.ok||!j?.ok){ console.error('Worker delete error',r.status,t);
              alert('Удаление на сервере не удалось ('+r.status+'). Публикация скрыта локально, но вернётся после перезагрузки.');
            }
          }).catch(err=>{
            console.error(err);
            alert('Сетевая ошибка при удалении: '+(err?.message||err));
          });
        }
      });
    }
    bindDelete(newsPost);
    bindDelete(freshPost);

    copyExport.addEventListener('click', ()=>{ exportHtml.select(); document.execCommand('copy'); });

    // плейсхолдеры на старте
    ensureEmptyPlaceholder(newsPost);
    ensureEmptyPlaceholder(freshPost);
  })();
  </script>
</body>
</html>
